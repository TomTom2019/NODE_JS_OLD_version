/////////////////
///// EXPRESS ////
////////////////
==> npm init
==> npm install express
==> npm install -g nodemon
/////////////////////////////
// PARAMS AND QUERYSTRING//
//////////////////////////
==>const express = require('express');
const app = express();

app.get('/',(req,res)=>{
    res.send('<html><body><h1 style="background:red">Hello there</h1></body></html>')
})

app.get('/api/:username/:id',(req,res)=>{
    let id = req.params.id;
    let username = req.params.username;
    res.send(`<html>
        <body>
            <h1 style="background:red">The user id is ${id} and the username is ${username}</h1>
        </body>
    </html>`)
    // res.send({
    //     name:'francis',
    //     lastname:'jones'
    // });
})

app.get('/api/car',(req,res)=>{
    // http://localhost:3000/api/car?brand=ford&model=fiesta
    let brand = req.query.brand;
    let model = req.query.model;

    res.send({
        brand,
        model
    })
})
const port = process.env.PORT || 3000;
app.listen(port);

/////////////////
///// MIDDLEWARE ////
////////////////

//APP.USE IS A MIDDLEWARE
app.use('/css', express.static( __dirname + '/public/css') );// __DIRNAME =ROOT

app.use('/',(req,res, next)=>{
   // console.log('someone made a request !! - ' + req.url);
   res.cookie('CookieName','cookievalue');
    next();
});

//INSTALL BODY PARSER
==> npm install bodyparser
==>app.use(bodyParser.json())
const urlencodedParser = bodyParser.urlencoded({extended:false});
const hello = (req,res,next) => {
    console.log('hello');
    next();
}
===> app.post('/api/queryadd',urlencodedParser,(req,res)=>{
    const firstname = req.body.firstname;
    const lastname = req.body.lastname;

    console.log(firstname)
    console.log(lastname)
    res.sendStatus(200)
})

// BELOW FORM_HTML
==><html>
    <body>
        <h1>Enter new user</h1>
        <form method="POST" action="/api/queryadd">
            <div>Enter first name</div>
            <input type="text" name="firstname" id="firstname"/>

            <div>Enter lastname</div>
            <input type="text" name="lastname" id="lastname"/>

            <input type="submit" value="Submit"/>
        </form>
    </body>
</html>
//////////////////////
/// EXPRESS REACT ////
///////////////////////
//CREATE CLIENT FOLDER
// CREATE SERVER.JS  FILE
==> npm init
==> npm install body-parser express
==> IN CLIENT
==> npx create-react-app .
==> npm install -g concurrently
// GO TO PACKAGE.JSON  SERVER
==>"scripts": {
  "test": "echo \"Error: no test specified\" && exit 1",
  "start": "node server.js",
  "server":"nodemon server.js",
  "client":"npm run start --prefix client",
  "dev":"concurrently \"npm run server\" \"npm run client\""
},
// SERVER.JS BELOW
==>const express = require('express');
const app = express();


app.get('/api/users',(req,res)=>{
    res.json([
        {
            id:1,
            username:'Dale'
        },
        {
            id:1,
            username:'Tom'
        }
    ])
})
const port = process.env.PORT || 3001;
app.listen(port)

//GO TO CLIENT
==> npm install axios --save
// APP.JS BELOW
==>import React, { Component } from 'react';
import axios from 'axios';

class App extends Component {
  componentDidMount(){
    axios.get('/api/users')
    .then( response =>{
      console.log(response.data)
    })
  }
  render(){
  return (
    <div className="App">
        Hello
    </div>
  )
}
}
export default App;
// INDEX.JS  BELOW
==>import React from 'react';
import ReactDOM from 'react-dom';
import App from './App';

ReactDOM.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
  document.getElementById('root')
);

// PACKEGE.JSON  CLIENT
==>    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  },
  "proxy":"http://localhost:3001"// IMPORTANT
}
//////////////////////
/// CONNECTING MONGO ////
///////////////////////
==> npm install mongodb

==> const express = require('express');
const app = express();
const { MongoClient } = require('mongodb');

const mongoUri = 'HERE YOUR MONDODB';

MongoClient.connect(mongoUri,{ useUnifiedTopology: true },(err, client)=>{
   if(err){
        throw err;
    }
   console.log('connected to the db') FOR TEXTING IF YOUR DB WORKING
})
const port = process.env.PORT || 3001;
app.listen(port)

//////////////////////
/// AD DATA TO DB ////
//////////////////////
GO TO CLIENT APP.JS  BELOW
==>import React, { Component } from 'react';
import axios from 'axios';

class App extends Component {

  addUser(){
    axios.get('/api/users')
    .then( response =>{
      console.log(response.data)
    }).catch(()=>{
      console.log('crap')
    })
  }

  render(){
  return (
    <div className="App">
        <button
          onClick={()=> this.addUser()}
        >
          Add user
        </button>
    </div>
  )
}
}
export default App;
++ GO TO SERVER.JS
==>const express = require('express');
const app = express();
const { MongoClient } = require('mongodb');

const mongoUri = 'HERE YOUR DB';

const client = new MongoClient(mongoUri);

app.get('/api/users', async(req,res)=>{
   try {
    await client.connect(); //
    const database = client.db('myApp');// CREATE database
    const collection = database.collection('users')
    const query = await collection.insertOne({
        name:"Francis",
        lastname:"Jones"
    });

    console.log(query)

    res.status(200).json({awesome:'yes'});
   } catch(error) {
    throw error;
   } finally {
    await client.close();
    console.log('all is done')
   }
})

const port = process.env.PORT || 3001;
app.listen(port)
++ GO TO MONGO DB WEBSITE AND COLLETION  BELLOW
{"_id":{"$oid":"614875e5e09670f77e672cea"},"name":"Francis","lastname":"Jones"}
